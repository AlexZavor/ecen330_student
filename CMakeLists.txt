cmake_minimum_required (VERSION 3.14.5)

set(XIL_VITIS_PATH /opt/Xilinx/Vitis/2019.2)

project(ecen330)

# Include the cmake file that include supplementary options for the 
# ARM compiler toolchain.  This tells the compiler what type of 
# processor (and it's features) we are compiling for.
include(xil_arm_toolchain/toolchain.cmake)

# Places to search for .h header files
include_directories(".")
include_directories("xil_arm_toolchain/bsp/ps7_cortexa9_0/include")

# link_directories instructs the compiler where it should look for libraries.
link_directories("xil_arm_toolchain")

# Subdirectories to look for other CMakeLists.txt files
add_subdirectory(supportFiles)
add_subdirectory(my_libs)
add_subdirectory(lab1)
add_subdirectory(lab2)
add_subdirectory(lab3)
add_subdirectory(lab4)
add_subdirectory(lab5)
add_subdirectory(lab6)
add_subdirectory(lab7)

# The rest of this file is to add custom targets to the Makefile that is generated by CMake.
# For example, this allows your to run 'make program' to program the board.

# make program ELF_PATH=...
# This target calls 'run_program.py' and provides the path of the ELF exectuble you want to run on the board
add_custom_target(program)
add_custom_command(TARGET program
    COMMAND if [ -z \${ELF_PATH} ]\; then echo '\\033[0;31mYou need to specify an ELF_PATH.  For example: make program ELF_PATH=lab1/lab1.elf\\033[0m'\;exit 1\; fi
    COMMAND if [ ! -f \${ELF_PATH} ]\; then echo '\\033[0;31mThe file \${ELF_PATH} does not exist.\\033[0m'\;exit 1\; fi
    COMMAND ../run_program.py \${ELF_PATH}
)

# make BOOT.bin ELF_PATH=...
# This target is used to create SD card images (ECEN 390 only).
add_custom_target(BOOT.bin)
add_custom_command(TARGET BOOT.bin
    COMMAND if [ -z \${ELF_PATH} ]\; then echo '\\033[0;31mYou need to specify an ELF_PATH.  For example: make BOOT.bin ELF_PATH=lab1/lab1.elf\\033[0m'\;exit 1\; fi
    COMMAND if [ ! -f \${ELF_PATH} ]\; then echo '\\033[0;31mThe file \${ELF_PATH} does not exist.\\033[0m'\;exit 1\; fi
    COMMAND ${XIL_VITIS_PATH}/bin/sdcard_gen --xpfm ../hw/platform/330_platform.xpfm --sys_config 330_platform --bif ../hw/platform/sw/330_platform/boot/330_platform.bif --bitstream ../hw/330_hw_system.bit --elf \${ELF_PATH},ps7_cortexa9_0
)